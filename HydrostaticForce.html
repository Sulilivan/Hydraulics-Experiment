<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>静水总压力实验计算</title>
    <style>
        table, th, td {
            border: 1px solid #333;
            border-collapse: collapse;
            padding: 4px 8px;
            text-align: center;
        }
        th {
            background: #f0f0f0;
        }
        input[type="text"] {
            width: 70px;
        }
        /* 去除number类型的样式 */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
<h2>净水总压力实验数据输入与计算</h2>
<form id="expForm" autocomplete="off">
    <h3>2、有关常数</h3>
    <label>天平臂距离 L₀ (cm)：<input name="L0" type="text" required></label>
    <label>扇形体垂直距离 L (cm)：<input name="L" type="text" required></label>
    <label>扇形体宽度 b (cm)：<input name="b" type="text" required></label>
    <span>扇形体平面高度 H₀ (cm)：<b>10.00</b>（已设为常数）</span>
    <br><br>
    <h3>3、量测记录表格</h3>
    <table>
        <tr>
            <th rowspan="2">压强分布形式</th>
            <th rowspan="2">测次</th>
            <th colspan="1">水位读数 H (cm)</th>
            <th colspan="1">砝码质量 m (g)</th>
        </tr>
        <tr>
            <th>H</th>
            <th>m</th>
        </tr>
        <!-- 三角形分布 -->
        <tr>
            <td rowspan="3">三角形分布</td>
            <td>1</td>
            <td><input name="H_tri_1" type="text" required></td>
            <td><input name="m_tri_1" type="text" required></td>
        </tr>
        <tr>
            <td>2</td>
            <td><input name="H_tri_2" type="text" required></td>
            <td><input name="m_tri_2" type="text" required></td>
        </tr>
        <tr>
            <td>3</td>
            <td><input name="H_tri_3" type="text" required></td>
            <td><input name="m_tri_3" type="text" required></td>
        </tr>
        <!-- 梯形分布 -->
        <tr>
            <td rowspan="3">梯形分布</td>
            <td>1</td>
            <td><input name="H_trap_1" type="text" required></td>
            <td><input name="m_trap_1" type="text" required></td>
        </tr>
        <tr>
            <td>2</td>
            <td><input name="H_trap_2" type="text" required></td>
            <td><input name="m_trap_2" type="text" required></td>
        </tr>
        <tr>
            <td>3</td>
            <td><input name="H_trap_3" type="text" required></td>
            <td><input name="m_trap_3" type="text" required></td>
        </tr>
    </table>
    <br>
    <button type="button" onclick="calc()">计算并输出结果</button>
</form>
<br>
<div id="result"></div>
<script>
function calc() {
    // 常量
    const rho = 1000; // kg/m³
    const g = 9.81; // m/s²
    const gcm = 9.81e-2; // cm单位下的g, N/(g·cm)
    const H0 = 10.00; // cm，已设为常数
    // 读取常数
    const form = document.getElementById("expForm");
    const L0 = +form.elements["L0"].value; // cm
    const L = +form.elements["L"].value;   // cm
    const b = +form.elements["b"].value;   // cm

    // 输出表头
    let html = `<h3>4、计算表格</h3>
    <table>
    <tr>
        <th>压强分布形式</th>
        <th>测次</th>
        <th>作用点距底部距离<br>e (cm)</th>
        <th>作用点距支点垂直距离<br>L₁ = L - e (cm)</th>
        <th>实测力矩<br>M₀ = m·g·L₀ (Ncm)</th>
        <th>实测静水压力<br>P实 (N)</th>
        <th>理论静水压力<br>P理 (N)</th>
        <th>相对值<br>y = P实 / P理</th>
    </tr>
    `;

    // 计算并输出每组数据
    let rows = '';
    // 三角形分布
    for(let i=1;i<=3;i++) {
        let H = +form.elements[`H_tri_${i}`].value; // cm
        let m = +form.elements[`m_tri_${i}`].value; // g
        // 作用点距底部距离 e = H / 3
        let e = (H / 3).toFixed(2);
        // 作用点距支点垂直距离 L1 = L - e
        let L1 = (L - e).toFixed(2);
        // 实测力矩 M0 = m·g·L0 (Ncm)
        let M0 = (m * g * L0 * 0.001).toFixed(2);
        // 实测静水压力 P实 = M0 / L1 (N)
        let P_exp = (L1 != 0 ? (M0 / L1).toFixed(2) : '');
        // 理论静水压力 P理 = 0.5 * rho * g * b * H^2 (cm制，需转m)
        let H_m = H / 100;
        let b_m = b / 100;
        let P_theory = (0.5 * rho * g * b_m * H_m * H_m).toFixed(2);
        // 相对值
        let y = (P_theory != 0 ? (P_exp / P_theory).toFixed(3) : '');
        rows += `<tr>
            <td>三角形分布</td>
            <td>${i}</td>
            <td>${e}</td>
            <td>${L1}</td>
            <td>${M0}</td>
            <td>${P_exp}</td>
            <td>${P_theory}</td>
            <td>${y}</td>
        </tr>`;
    }
    // 梯形分布
    for(let i=1;i<=3;i++) {
        let H = +form.elements[`H_trap_${i}`].value; // cm
        let m = +form.elements[`m_trap_${i}`].value; // g
        let H0_cm = H0;
        let h = H - H0_cm; // 上部三角形高
        // 梯形分布水压力作用点 e = (a/3) * (2*h1 + h2)/(h1 + h2)
        // a = H0_cm, h1 = H - H0_cm, h2 = H
        let a = H0_cm;
        let h1 = H - H0_cm;
        let h2 = H;
        let denominator = h1 + h2;
        let e = (denominator !== 0 ? (a / 3 * (2 * h1 + h2) / denominator).toFixed(2) : '');
        // 作用点距支点垂直距离 L1 = L - e
        let L1 = (L - e).toFixed(2);
        // 实测力矩 M0 = m·g·L0 (Ncm)
        let M0 = (m * g * L0 * 0.001).toFixed(2);
        // 理论静水压力 P理 = 0.5 * rho * g * b * H0^2 + rho * g * b * H0 * h
        let H0_m = H0_cm / 100;
        let h_m = h / 100;
        let b_m = b / 100;
        let P_theory = (0.5 * rho * g * b_m * H0_m * H0_m + rho * g * b_m * H0_m * h_m).toFixed(2);
        // 实测静水压力 P实 = M0 / L1 (N)
        let P_exp = (L1 != 0 ? (M0 / L1).toFixed(2) : '');
        // 相对值
        let y = (P_theory != 0 ? (P_exp / P_theory).toFixed(3) : '');
        rows += `<tr>
            <td>梯形分布</td>
            <td>${i}</td>
            <td>${e}</td>
            <td>${L1}</td>
            <td>${M0}</td>
            <td>${P_exp}</td>
            <td>${P_theory}</td>
            <td>${y}</td>
        </tr>`;
    }
    // 输出表格
    html += rows + '</table>';
    document.getElementById('result').innerHTML = html;
}
// 回车和方向键控制输入框切换
document.addEventListener('DOMContentLoaded', function() {
    const inputs = Array.from(document.querySelectorAll('input[type="text"]'));
    inputs.forEach((input, idx) => {
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                let next = inputs[idx + 1];
                if (next) next.focus();
            }
            // 上下左右方向键
            if (['ArrowDown','ArrowUp','ArrowLeft','ArrowRight'].includes(e.key)) {
                e.preventDefault();
                // 计算表格结构：每行2个输入，常数区3个输入
                let constLen = 3; // 常数区3个
                let rowLen = 2; // 每行2个输入
                let totalRows = 6; // 6行数据
                let baseIdx = constLen; // 数据区起始
                let pos = idx - baseIdx;
                if (idx < baseIdx) return; // 常数区不处理方向键
                if (pos >= 0 && pos < totalRows * rowLen) {
                    let row = Math.floor(pos / rowLen);
                    let col = pos % rowLen;
                    let nextIdx = idx;
                    if (e.key === 'ArrowRight' && col < rowLen - 1) nextIdx = idx + 1;
                    if (e.key === 'ArrowLeft' && col > 0) nextIdx = idx - 1;
                    if (e.key === 'ArrowDown' && row < totalRows - 1) nextIdx = idx + rowLen;
                    if (e.key === 'ArrowUp' && row > 0) nextIdx = idx - rowLen;
                    if (inputs[nextIdx]) inputs[nextIdx].focus();
                }
            }
        });
    });
});
</script>
</body>
</html>